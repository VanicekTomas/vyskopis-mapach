<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>VÝŠKOPIS NA MAPÁCH – výukový materiál</title>
  <meta name="description" content="Mobilně optimalizovaný výukový materiál k tématu výškopis na mapách." />
  <style>
    :root{
      --bg: #0b1020;
      --card:#11162a;
      --muted:#a9b0c2;
      --text:#f4f6fb;
      --accent:#6ea8fe;
      --accent-2:#66f0c6;
      --danger:#ff6b6b;
      --ok:#59d98a;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    *,*::before,*::after{ box-sizing: border-box; }
    img{ max-width:100%; height:auto; display:block }
    .row>div{ min-width:0 }
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      background: radial-gradient(1000px 600px at 50% -20%, #1b2240 0%, #0b1020 60%, #0b1020 100%);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      line-height:1.5;
    }
    .container{max-width: 860px; margin-inline:auto; padding: clamp(16px, 3vw, 28px);}
    header{ text-align:center; margin-bottom: 18px;}
    h1{font-size: clamp(1.6rem, 4.8vw, 2.4rem); letter-spacing:.02em; margin: 8px 0 6px;}
    p.lead{color:var(--muted); margin:0 auto 6px; max-width: 50ch}

    .card{ background: var(--card); border: 1px solid rgba(255,255,255,.06); border-radius: var(--radius); box-shadow: var(--shadow); background-clip: padding-box; overflow:hidden; }
    .section{ padding: clamp(14px, 3.2vw, 22px); }
    .stack{ display:grid; gap: 12px; }
    .row{ display:grid; gap:10px; grid-template-columns: 1fr; }
    @media (min-width: 680px){ .row.two{ grid-template-columns: 1fr 1fr; gap:12px } }

    label{ font-weight: 600; font-size: .95rem; }
    .hint{ font-size:.88rem; color: var(--muted); }

    input[type="text"], input[type="email"], textarea{
      width:100%; padding: 12px 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03); color: var(--text); outline: none; transition: .2s ease border-color, .2s ease box-shadow;
    }
    input::placeholder, textarea::placeholder{ color:#8e96ab }
    input:focus, textarea:focus{ border-color: var(--accent); box-shadow: 0 0 0 4px rgba(110,168,254,.15) }

    .toolbar{ display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap }
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:.6ch; padding: 11px 14px; border-radius: 999px; border:1px solid rgba(255,255,255,.12);
          background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); color: var(--text); text-decoration:none; cursor:pointer; transition:.2s ease transform, .2s ease opacity, .2s ease background;
    }
    .btn:hover{ transform: translateY(-1px) }
    .btn.primary{ background: linear-gradient(180deg, #4584ff, #356bff); border-color: #2e63f7 }
    .btn.good{ background: linear-gradient(180deg, #3ecf8e, #2fb37a); border-color: #22a069 }
    .btn.ghost{ background: rgba(255,255,255,.06) }
    .btn.danger{ background: linear-gradient(180deg, #ff7b7b, #ff5f5f); border-color: #ff5454 }

    figure{ margin:0 }
    .map-thumb{ border-radius: 14px; overflow:hidden; border:1px solid rgba(255,255,255,.08); cursor: zoom-in }
    .map-thumb img{ width:100%; display:block; height:auto }
    .map-caption{ color: var(--muted); font-size:.9rem; margin-top:6px }

    /* Modal (full-screen) */
    dialog#mapModal{ width:100vw; height:100vh; max-width: none; max-height:none; padding:0; border:0; background:#050810ee; }
    dialog::backdrop{ background: rgba(0,0,0,.55) }
    .modal-bar{ display:flex; align-items:center; justify-content:space-between; gap:8px; padding:8px 10px; border-bottom:1px solid rgba(255,255,255,.09); background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); position: sticky; top:0; z-index:5 }
    .modal-title{ font-weight:700 }
    .canvas-wrap{ position:relative; width:100%; height: calc(100vh - 54px); overflow:hidden; touch-action: none; background:#000 }
    .panzoom{ position:absolute; inset:0; display:grid; place-items:center; transform-origin: 0 0; }
    .panzoom img{ max-width:none; width:auto; height:auto; user-select:none; -webkit-user-drag:none }

    /* Notices */
    .notice{ display:none; padding: 10px 12px; border-radius: 12px; border:1px solid rgba(255,255,255,.12); margin-top: 10px; font-size:.95rem }
    .notice.ok{ background: rgba(89,217,138,.1); border-color: rgba(89,217,138,.35) }
    .notice.err{ background: rgba(255,107,107,.1); border-color: rgba(255,107,107,.35) }

    footer{ color: var(--muted); font-size:.85rem; text-align:center; padding: 24px 0 40px }
    .pill{ display:inline-block; padding:3px 10px; border:1px solid rgba(255,255,255,.18); border-radius:999px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="pill">Výukový materiál – mobilní verze</div>
      <h1>VÝŠKOPIS NA MAPÁCH</h1>
      <p class="lead">QR kódem jste se dostali na stránku pro práci s topografickou mapou. Vyplňte prosím své jméno a řešení zadaných úloh. Mapu lze otevřít na celou obrazovku a prsty přibližovat/oddalovat.</p>
    </header>

    <main class="stack">
      <!-- Identifikace studenta -->
      <section class="card section">
        <div class="stack">
          <div class="row two">
            <div>
              <label for="fullname">Jméno a příjmení</label>
              <input id="fullname" name="fullname" type="text" placeholder="např. Jan Novák" autocomplete="name" />
            </div>
            <div>
              <label for="email">Školní e‑mail (volitelné)</label>
              <input id="email" name="email" type="email" placeholder="např. jan.novak01@upol.cz" autocomplete="email" />
              <div class="hint">E‑mail se odešle společně s odpověďmi (pokud vyplníte).</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Mapa – náhled a modal -->
      <section class="card section">
        <div class="toolbar">
          <div>
            <strong>Práce s mapou:</strong>
            <span class="hint">klepněte pro otevření na celou obrazovku, poté přibližujte a posouvejte.</span>
          </div>
          <button class="btn ghost" id="openMapBtn" type="button">Otevřít mapu</button>
        </div>
        <figure class="map-thumb" id="mapThumb">
          <!-- Náhled zrychlen: zkuste nahrát menší náhled Vzor_Boskovice_thumb.jpg (~1200px). Pokud není k dispozici, spadne to na plnou verzi. -->
          <img id="thumbImg" src="Vzor_Boskovice_thumb.jpg" data-full="Vzor_Boskovice.jpg" alt="Topografická mapa – vzor Boskovice (náhled)" loading="lazy" decoding="async" fetchpriority="low" onerror="this.onerror=null; this.src='Vzor_Boskovice.jpg'" />
        </figure>
      </section>

      <!-- Úloha 1 -->
      <section class="card section">
        <h2 style="margin-top:0">Úloha 1 – Najděte, kde se ukrývá kočička</h2>
        <p>Na základě indicií určete <strong>název objektu</strong> a <strong>název obce</strong>, kde se ukrývá kočička. Příběh udává postup kočičky terénem a využívá prvky výškopisu (kóty, vrstevnice, sklon svahu).</p>
        <p>Babičce se ztratila její kočička. Naštěstí měla kočička na sobě GPS záznamník, takže babička si mohla online nastudovat, kudy kočička šla. Záznam trasy se bohužel neuchovává, a tak máme k dispozici jen povídání babičky.</p>
        <details>
          <summary><strong>Povídání babičky</strong> – rozklikněte</summary>
          <p style="margin-top:8px">„Jsem z <em>Voděrad</em> a bydlím na západním okraji obce v chatové oblasti u hřbitova. Kočička se vydala <strong>západně do kopce</strong> kolem <strong>poddolované oblasti</strong> a nahoře minula <strong>kótu 470</strong>. Potom pokračovala <strong>na sever směrem na Chlum</strong>. Těsně pod vrcholem Chlum se zastavila na <strong>vrstevnici ve výšce 490 m n. m.</strong> Po této vrstevnici šla dlouho na <strong>západ</strong> až na <strong>západní úpatí</strong>. Nakonec se vydala <strong>jihozápadně prudce z kopce</strong>, sešla přibližně <strong>70 výškových metrů</strong> k vesnici a tam našla <strong>nápadný objektm který je v mapě označený popisem</strong>. Potřebuji vědět, jak se ten objekt jmenuje a v jaké obci je.“</p>
        </details>
        <div class="row two" style="margin-top:10px">
          <div>
            <label for="objekt1">Název objektu</label>
            <input id="objekt1" name="objekt1" type="text" placeholder="např. kostel" />
          </div>
          <div>
            <label for="obec1">Název obce</label>
            <input id="obec1" name="obec1" type="text" placeholder="např. Radíkov" />
          </div>
        </div>
      </section>

      <!-- Úloha 2 -->
      <section class="card section">
        <h2 style="margin-top:0">Úloha 2 – Volba vrcholu pro vyhlídku</h2>
        <p>Najděte v mapě vrchol vhodný pro malou vyhlídku. Kvůli dotacím musí splnit tyto podmínky:</p>
        <ul>
          <li>nadmořská výška minimálně <strong>581 m n. m.</strong>,</li>
          <li>vrchol je <strong>pojmenovaný</strong> a na mapě <strong>označen kótou</strong>,</li>
          <li>z vrcholu je <strong>výhled do okolí</strong> (není zalesněn),</li>
          <li>vzdálenost <strong>do 700 m vzdušnou čarou</strong> od středu nejbližší obce,</li>
          <li>na vrchol <em>nemusí</em> vést cesta.</li>
        </ul>
        <div class="row">
          <div>
            <label for="vrchol2">Název zvoleného vrcholu</label>
            <input id="vrchol2" name="vrchol2" type="text" placeholder="např. Chlum (592)" />
          </div>
        </div>
      </section>

      <!-- Odeslání -->
      <section class="card section">
        <div class="toolbar">
          <button class="btn" type="button" id="saveBtn">Uložit rozepsané odpovědi</button>
          <div class="hint">Vaše odpovědi se průběžně ukládají i automaticky (lokálně v zařízení).</div>
        </div>
        <div class="toolbar" style="margin-top:10px">
          <button class="btn primary" type="button" id="sendBtn">Odeslat odpovědi</button>
          <button class="btn ghost" type="button" id="resetBtn">Vymazat formulář</button>
        </div>
        <div class="notice ok" id="okMsg">Odpovědi byly připraveny k odeslání e‑mailem. Zkontrolujte prosím vaši poštu.</div>
        <div class="notice err" id="errMsg"></div>
        
      </section>
    </main>

    <footer>
      <div>© <span id="year"></span> Navrhl a vytvořil Tomáš Vaníček</div>
    </footer>
  </div>

  <!-- Fullscreen modal s pinch‑to‑zoom -->
  <dialog id="mapModal">
    <div class="modal-bar">
      <div class="modal-title">Mapa – režim celé obrazovky</div>
      <div class="toolbar">
        <button class="btn ghost" type="button" id="resetViewBtn">Resetovat zobrazení</button>
        <button class="btn danger" type="button" id="closeMapBtn">Zavřít</button>
      </div>
    </div>
    <div class="canvas-wrap" id="canvasWrap">
      <div class="panzoom" id="pz">
        <img id="bigMap" alt="Topografická mapa – vzor Boskovice, plné zobrazení" />
      </div>
    </div>
  </dialog>

  <script>
    // ---------- Pomocné funkce a stav ----------
    const $ = sel => document.querySelector(sel);
    const byId = id => document.getElementById(id);
    const inputs = ["fullname","email","objekt1","obec1","vrchol2"];
    const storageKey = "vyskopis-form-v2";
  
    function saveToLocal(){
      const data = Object.fromEntries(inputs.map(id => [id, byId(id).value.trim()]));
      localStorage.setItem(storageKey, JSON.stringify(data));
    }
    function loadFromLocal(){
      try{
        const data = JSON.parse(localStorage.getItem(storageKey)||"{}");
        inputs.forEach(id => { if(data[id]) byId(id).value = data[id]; });
      }catch(e){}
    }
    function clearLocal(){ localStorage.removeItem(storageKey); }
  
    // ---------- Inicializace ----------
    document.addEventListener('DOMContentLoaded', () => {
      byId('year').textContent = new Date().getFullYear();
      loadFromLocal();
      inputs.forEach(id => byId(id).addEventListener('input', saveToLocal));
  
      // Ovládání náhledu / modalu
      byId('mapThumb').addEventListener('click', openModal);
      byId('openMapBtn').addEventListener('click', openModal);
      byId('closeMapBtn').addEventListener('click', closeModal);
      byId('resetViewBtn').addEventListener('click', resetView);
  
      // Ovládání formuláře
      byId('saveBtn').addEventListener('click', () => { saveToLocal(); toastOK('Odpovědi byly uloženy do zařízení.'); });
      byId('resetBtn').addEventListener('click', () => {
        if(confirm('Opravdu vymazat všechna pole?')){
          inputs.forEach(id => byId(id).value = '');
          clearLocal();
          toastOK('Formulář byl vymazán.');
        }
      });
      byId('sendBtn').addEventListener('click', handleSend);
  
      // Inicializace pan/zoom
      setupPanZoom();
    });
  
    // ---------- Validace a odeslání ----------
    function handleSend(){
      const data = Object.fromEntries(inputs.map(id => [id, byId(id).value.trim()]));
      const missing = [];
      if(!data.fullname) missing.push('Jméno a příjmení');
      if(!data.objekt1) missing.push('Název objektu (Úloha 1)');
      if(!data.obec1)   missing.push('Název obce (Úloha 1)');
      if(!data.vrchol2) missing.push('Název vrcholu (Úloha 2)');
      if(missing.length){ return toastERR('Chybí vyplnit: '+missing.join(', ')); }
  
      const email = data.email;
      if(email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
        return toastERR('Zadejte platný e-mail nebo pole ponechte prázdné.');
      }
  
      saveToLocal();
  
      const to = 'tomas.vanicek@upol.cz';
      const subject = encodeURIComponent('VÝŠKOPIS – odevzdané odpovědi');
      const body = encodeURIComponent(
        `Student: ${data.fullname}\n`+
        (email?`E-mail: ${email}\n`:``)+
        `\nÚloha 1:\n  Název objektu: ${data.objekt1}\n  Název obce: ${data.obec1}\n`+
        `\nÚloha 2:\n  Zvolený vrchol: ${data.vrchol2}\n`+
        `\nOdesláno: ${new Date().toLocaleString('cs-CZ')}\n`
      );
      window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
      toastOK('Odpovědi byly připraveny k odeslání v e-mailovém klientu.');
    }
  
    function toastOK(msg){ const el = byId('okMsg'); el.textContent = msg; el.style.display='block'; const er = byId('errMsg'); er.style.display='none'; }
    function toastERR(msg){ const el = byId('errMsg'); el.textContent = msg; el.style.display='block'; const ok = byId('okMsg'); ok.style.display='none'; }
  
    // ---------- Modal ----------
    function openModal(){
      const modal = byId('mapModal');
      const big   = byId('bigMap');
      const thumb = byId('thumbImg');
      const fullSrc = (thumb && thumb.dataset.full) ? thumb.dataset.full : 'Vzor_Boskovice.jpg';
      if(!big.getAttribute('src')){
        big.src = fullSrc;
        big.onload = () => { fitToScreen(); };
      } else {
        setTimeout(fitToScreen, 0);
      }
      modal.showModal();
    }
    function closeModal(){ byId('mapModal').close(); }
  
    // ---------- Pan/Zoom s kotevním bodem gesta ----------
    const state = {
      x:0, y:0, scale:1,
      minScale: 1, maxScale: 8,
      pointers:new Map(),
      startX:0, startY:0,             // pro jedno-prstý pan
      startScale:1, startDist:0,      // pro pinch
      imgW:0, imgH:0, vw:0, vh:0
    };
  
    function setupPanZoom(){
      const wrap = byId('canvasWrap');
      const pz   = byId('pz');
  
      const apply = () => {
        bound();
        pz.style.transform = `translate(${state.x}px, ${state.y}px) scale(${state.scale})`;
      };
  
      const getTwoPointers = () => Array.from(state.pointers.values()).slice(0,2);
      const distance = (a,b) => Math.hypot(a.clientX-b.clientX, a.clientY-b.clientY);
  
      wrap.addEventListener('pointerdown', (e)=>{
        wrap.setPointerCapture(e.pointerId);
        state.pointers.set(e.pointerId, e);
  
        // pro jednoprstý pan
        state.startX = e.clientX - state.x;
        state.startY = e.clientY - state.y;
  
        if(state.pointers.size === 2){
          const [p1,p2] = getTwoPointers();
          state.startDist  = distance(p1,p2);
          state.startScale = state.scale;
        }
      });
  
      wrap.addEventListener('pointermove', (e)=>{
        if(!state.pointers.has(e.pointerId)) return;
        state.pointers.set(e.pointerId, e);
  
        if(state.pointers.size === 1){
          // pan jedním prstem
          state.x = e.clientX - state.startX;
          state.y = e.clientY - state.startY;
          apply();
        } else if(state.pointers.size >= 2){
          // pinch + souběžný posun – anchor = aktuální střed prstů
          const rect = wrap.getBoundingClientRect();
          const [p1,p2] = getTwoPointers();
          const midX = (p1.clientX + p2.clientX)/2 - rect.left;
          const midY = (p1.clientY + p2.clientY)/2 - rect.top;
  
          const dist = distance(p1,p2);
          if(!state.startDist){ state.startDist = dist; state.startScale = state.scale; }
  
          const newScale = clamp(state.startScale * (dist / state.startDist), state.minScale, state.maxScale);
          setScaleAt(midX, midY, newScale); // zajistí i přirozený posun podle pohybu středu prstů
          apply();
        }
      });
  
      const release = (e)=>{
        state.pointers.delete(e.pointerId);
        // když zůstal jeden prst, znovu zarovnej startX/startY pro plynulé pokračování panu
        if(state.pointers.size === 1){
          const p = state.pointers.values().next().value;
          state.startX = p.clientX - state.x;
          state.startY = p.clientY - state.y;
        }
        // reset pinch baseline
        if(state.pointers.size < 2){ state.startDist = 0; }
      };
      wrap.addEventListener('pointerup', release);
      wrap.addEventListener('pointercancel', release);
  
      // Kolečko myši – anchor = kurzor
      wrap.addEventListener('wheel', (e)=>{
        e.preventDefault();
        const rect = wrap.getBoundingClientRect();
        const ax = e.clientX - rect.left;
        const ay = e.clientY - rect.top;
        const factor = Math.exp((-e.deltaY) * 0.0015); // plynulé
        setScaleAt(ax, ay, state.scale * factor);
        apply();
      }, {passive:false});
  
      // Double-tap – anchor = kliknuté místo
      let lastTap = 0;
      wrap.addEventListener('click', (e)=>{
        const now = Date.now();
        if(now - lastTap < 300){
          const rect = wrap.getBoundingClientRect();
          const ax = e.clientX - rect.left;
          const ay = e.clientY - rect.top;
          const target = state.scale < state.minScale*1.8 ? Math.min(state.minScale*2, state.maxScale) : state.minScale;
          setScaleAt(ax, ay, target);
          apply();
        }
        lastTap = now;
      });
  
      // Reflow při změně velikosti
      window.addEventListener('resize', ()=>{ if(byId('mapModal').open) fitToScreen(false); });
  
      window.__pzApply = apply;
    }
  
    function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }
  
    // Změna měřítka kolem kotevního bodu (ax, ay) ve viewport souřadnicích
    function setScaleAt(ax, ay, newScale){
      newScale = clamp(newScale, state.minScale, state.maxScale);
      const px = (ax - state.x) / state.scale;
      const py = (ay - state.y) / state.scale;
      state.scale = newScale;
      state.x = ax - px * state.scale;
      state.y = ay - py * state.scale;
    }
  
    function measure(){
      const wrap = byId('canvasWrap');
      const img  = byId('bigMap');
      state.vw = wrap.clientWidth; state.vh = wrap.clientHeight;
      state.imgW = img.naturalWidth || img.width; state.imgH = img.naturalHeight || img.height;
    }
  
    function fitToScreen(resetScale=true){
      measure();
      const s = Math.min(state.vw / state.imgW, state.vh / state.imgH);
      state.minScale = s; if(resetScale) state.scale = s;
      state.x = (state.vw - state.imgW*state.scale)/2;
      state.y = (state.vh - state.imgH*state.scale)/2;
      if(window.__pzApply) window.__pzApply();
    }
  
    function bound(){
      const w = state.imgW * state.scale;
      const h = state.imgH * state.scale;
      if(w <= state.vw){ state.x = (state.vw - w)/2; } else { state.x = clamp(state.x, state.vw - w, 0); }
      if(h <= state.vh){ state.y = (state.vh - h)/2; } else { state.y = clamp(state.y, state.vh - h, 0); }
    }
  
    function resetView(){ fitToScreen(); }
</script>
</body>
</html>
